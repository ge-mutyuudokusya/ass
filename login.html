<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daily Feed ログイン</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 420px; margin: 40px auto; }
    label { display:block; margin: 12px 0 4px; }
    input { width:100%; padding:10px; box-sizing:border-box; }
    button { margin-top:12px; padding:10px 14px; }
    .muted { color:#666; font-size:12px; margin-top:8px; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth, setPersistence, browserLocalPersistence,
      onAuthStateChanged, createUserWithEmailAndPassword,
      signInWithEmailAndPassword, sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // ★ Firebase構成（コンソールの値をそのまま貼り付けOK）
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDKjyxK2RixQKkpNp3kZkijDPGi39aNceE",
  authDomain: "daily-feed-414b6.firebaseapp.com",
  databaseURL: "https://daily-feed-414b6-default-rtdb.firebaseio.com",
  projectId: "daily-feed-414b6",
  storageBucket: "daily-feed-414b6.firebasestorage.app",
  messagingSenderId: "360432327059",
  appId: "1:360432327059:web:0cb52176305190294d3066",
  measurementId: "G-0R08TWS1WP"
};

    // 初期化
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    await setPersistence(auth, browserLocalPersistence); // ログイン状態を保持

    // すでにログインしていたらホームへ
    onAuthStateChanged(auth, (user) => {
      if (user) location.href = "home.html";
    });

    // UIハンドラ
    const emailEl = () => document.getElementById("email");
    const passEl  = () => document.getElementById("password");
    const disableWhile = async (btn, fn) => {
      btn.disabled = true; btn.textContent = "処理中…";
      try { await fn(); } finally { btn.disabled = false; btn.textContent = btn.dataset.label; }
    };

    window.handleRegister = (btn) => disableWhile(btn, async () => {
      await createUserWithEmailAndPassword(auth, emailEl().value, passEl().value);
      alert("登録成功！ログインしました。"); location.href = "home.html";
    });

    window.handleLogin = (btn) => disableWhile(btn, async () => {
      await signInWithEmailAndPassword(auth, emailEl().value, passEl().value);
      location.href = "home.html";
    });

    window.handleReset = async () => {
      const email = emailEl().value.trim();
      if (!email) return alert("メールアドレスを入力してください。");
      await sendPasswordResetEmail(auth, email);
      alert("パスワード再設定メールを送信しました。");
    };
  </script>
</head>
<body>
  <h1>Daily Feed ログイン</h1>
  <label>メールアドレス</label>
  <input type="email" id="email" autocomplete="email" required />
  <label>パスワード</label>
  <input type="password" id="password" autocomplete="current-password" required />
  <div>
    <button data-label="新規登録" onclick="handleRegister(this)">新規登録</button>
    <button data-label="ログイン" onclick="handleLogin(this)">ログイン</button>
  </div>
  <p class="muted"><a href="javascript:void 0" onclick="handleReset()">パスワードをお忘れですか？</a></p>
  <p class="muted">※ このログインはFirebase Authenticationを使用。APIキーは公開で問題ありません。</p>
</body>
</html>
